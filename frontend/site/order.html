<!DOCTYPE html>
<html lang="en">
     <head>
     <title>miumiu寵物商城</title>
     <meta charset="utf-8">
     <link rel="icon" href="images/favicon.ico">
     <link rel="shortcut icon" href="images/favicon.ico" />
     <link rel="stylesheet" href="css/style.css">
     <link rel="stylesheet" href="css/form.css">
     <script src="js/jquery.js"></script>
     <script src="js/init.js"></script>
     <script src="js/forms.js"></script>
     <script src="js/jquery-migrate-1.1.1.js"></script>
     <script src="js/superfish.js"></script>     
     <script src="js/jquery.equalheights.js"></script>
     <script src="js/jquery.easing.1.3.js"></script>
          <script src="js/jquery.ui.totop.js"></script>
          <script src="
          https://cdn.jsdelivr.net/npm/tw-city-selector@2.1.1/dist/tw-city-selector.min.js
          "></script>

     <script>
    
    jQuery(document).ready(function() {
    $().UItoTop({ easingType: 'easeOutQuart' });
    });
     </script>
     <!--[if lt IE 8]>
       <div style=' clear: both; text-align:center; position: relative;'>
         <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
           <img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." />
         </a>
      </div>
    <![endif]-->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <link rel="stylesheet" media="screen" href="css/ie.css">

    <![endif]-->
     </head>
     <body>
<!--==============================header=================================-->
<header> 
  <div class="container_12">
    <div class="grid_12"> 
    <h1><a href="index.html"><img src="images/logo.png" alt="Gerald Harris attorney at law"></a> </h1>
         <div class="menu_block">
           <nav  class="" >
            <ul class="sf-menu">
                   <!-- <li class="current"><a href="index.html">首頁</a></li> -->
                   <li><a href="index.html">首頁</a></li>
                   <li class="with_ul"><a href="product_list.html?list_for=貓咪商品">貓咪專區 </a>
                     <ul>
                         <li><a href="product_list.html?list_for=貓咪飼料"> 貓咪飼料</a></li>
                         <li><a href="product_list.html?list_for=貓咪罐頭">貓咪罐頭</a></li>
                         <li><a href="product_list.html?list_for=貓咪零食">貓咪零食</a></li>
                         <li><a href="product_list.html?list_for=貓咪用品">貓咪用品</a></li>
                     </ul>
                   </li>
                   <li class="with_ul"><a href="product_list.html?list_for=狗狗商品">狗狗專區</a>
                    <ul>
                      <li><a href="product_list.html?list_for=狗狗飼料">狗狗飼料</a></li>
                      <li><a href="product_list.html?list_for=狗狗罐頭">狗狗罐頭</a></li>
                      <li><a href="product_list.html?list_for=狗狗零食">狗狗零食</a></li>
                      <li><a href="product_list.html?list_for=狗狗用品">狗狗用品</a></li>
                  </ul>
                  </li>
                   <li><a href="adoption.html">浪浪之家 </a></li>
                 </ul>
              </nav>
           <div class="clear"></div>
           </div>
           <div class="clear"></div>
           <div class="right">
            <ul class="login">
              <li>
                <a href="carts.html"><img src="images/shop_car.png" title="我的購物車">
                <b class="my_car_count">0</b>
                </a>   
              </li>
              <li><a href="login.html" id="my_login">登入</a></li>
            </ul>
          </div>
      </div>
    </div>
</header>


<div class="content2 pt1">
  <!-- <div class="ic">More Website Templates @ TemplateMonster.com - June 10, 2013!</div> -->
  <div class="container_12">
    <div class="sign_up">
        <h3 class="ic1">商品訊息</h3>
        <p class="order_no">訂單編號：<span class="order_id">20230623</span></p>
    </div>
    <div class="grid_order prefix_1 ">
      <div class="item_info">
        <div class="item_title">
          <ul>
            <li class="p_name">商品訊息</li>
            <li class="p_price">單價</li>
            <li class="p_count">數量</li>
            <li class="p_tprice">金額</li>
          </ul>
        </div>
        <div class="item_detail">
          <!-- <ul>
            <li class="p_name">
              <img src="http://127.0.0.1:8000/media/sku/1_CWVre0U.png" alt="">
              <span class="pro_name lf">
                老犬飼料 長壽配方 低過敏 小顆粒 狗飼料
    
              </span>
              <p class="spec lf">尺寸：2KG</p>
            </li>
            <li class="p_price">
              <span class="pro_price">NT$
                <span class="ppp_price">100</span>
              </span>
            </li>
            <li class="p_count">2</li>
            <li class="p_tprice">
              <span class="pro_tprice">NT$</span>
              <span class="ppp_tprice">200</span>
            </li>
          </ul> -->
        </div>
        <div class="item_bot">
          <p>共<span class="tot_count">1</span>件商品 &nbsp;&nbsp;合計：<span class="tot_price">260</span>元</p>
          <p class="freight">運費+NT$ <span class="freight_price">60</span></p>
        </div>
      </div>
    </div>
        <span class="put_cart_again" id="put_cart_again">再次加入購物車</span>
    </div>
    

</div>
</div>
<!--=======content================================-->



<!--==============================footer=================================-->

<footer>    
  <div class="container_12">
    <div class="grid_12">
      <div class="socials">
        <a href="#"></a>
        <a href="#"></a>
        <a href="#"></a>
        <a href="#"></a>
      </div>
     <p>Pet Club  &copy; 2013 | <a href="#">Privacy Policy</a> | Website  designed by <a href="http://www.templatemonster.com/" rel="nofollow">TemplateMonster.com</a></p>
     
    </div>
    <div class="clear"></div>
  </div>
</footer>
</body>
<script>
$(function(){
$.getUrlParam = function (name) {
      var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
      var r = window.location.search.substr(1).match(reg);
      if (r != null) return r;
      return null;
    }    


    var order_id = $.getUrlParam('order_id')?$.getUrlParam('order_id')[2]:null
    console.log(order_id)
    if(order_id){
        $.ajax({
            type: 'get',
            url: baseUrl + '/v1/orders/order_detail/'+ order_id,
            beforeSend: function (request) {
                request.setRequestHeader('authorization', localStorage.getItem('miushop_token'))
            },
            success: function (data) {
                if (data.code == 403) {
                    alert('用戶認證已過期，請重新登入')
                    window.localStorage.removeItem('miushop_username');
                    window.localStorage.removeItem('miushop_email');
                    window.localStorage.removeItem('miushop_token');
                    window.localStorage.removeItem('miushop_cartscount');
                    window.location.href = 'login.html'
                }
                if (data.code == 200) {
                    // alert('獲取成功')
                    var html = '';
                    var IMG_URL = data.base_url;
                    var sl = data.data.skus_list
                    console.log(sl)
                    for(var i=0;i<sl.length;i++){
                      var spec = sl[i].sku_sale_attr_name.toString().split('/')[1]
                        html += `
                    <div class="p_info" data-id="${sl[i].id}">
                    <ul>
                        <li class="p_name" data-id="${sl[i].id}">
                          <a  href='product_details.html?spu_id=${sl[i].spu_id}'>
                          <img src="${IMG_URL + sl[i].image}" alt="">
                          </a>
                          <span class="pro_name lf">
                            <a href = 'product_details.html?spu_id=${sl[i].spu_id}'>
                            ${sl[i].name}
                            </a>
                          </span>
                          <p class="spec lf">${spec}：${sl[i].sku_sale_attr_value}</p>
                        </li>
                        <li class="p_price">
                          <span class="pro_price">NT$
                            <span class="ppp_price">${sl[i].price}</span>
                          </span>
                        </li>
                        <li class="p_count">${sl[i].count}</li>
                        <li class="p_tprice">
                          <span class="pro_tprice">NT$</span>
                          <span class="ppp_tprice">${sl[i].price * sl[i].count}</span>
                        </li>
                      </ul>
                      </div>
                    `
                      }            
                      }
                    $('.item_detail').html(html)

                    // 運費判斷
                    $('.freight_price').html(data.data.freight)
                    $('.order_id').html(data.data.order_id)
                    sumPrice()
                    sumNum()



                }
            })
        }
    })







  
  $('.put_cart_again').click(function(){
    var email = window.localStorage.getItem('miushop_email')
    $.ajax({
      type:'post',
      url:baseUrl+'/v1/orders/'+email+'/carts',
      contentType:'application/json',
      dataType:'json',
      data:JSON.stringify({
        'order_id':$('.order_id').text()
      }),
      beforeSend: function (request) {
                request.setRequestHeader('authorization', localStorage.getItem('miushop_token'))
            },
            success: function (data) {
                if (data.code == 403) {
                    alert('用戶認證已過期，請重新登入')
                    window.localStorage.removeItem('miushop_username');
                    window.localStorage.removeItem('miushop_email');
                    window.localStorage.removeItem('miushop_token');
                    window.localStorage.removeItem('miushop_cartscount');
                    window.location.href = 'login.html'
                }
                if(data.code==200){
                  window.localStorage.setItem('miushop_cartscount',data.carts_count)
                  $('.my_car_count').text(data.carts_count)
                  alert('添加成功')
                }
                else{
                  alert(data.error)
                }
              }
    })


  })




function sumPrice(){
  var total = 0
  $('.ppp_tprice').each(function(index,element){
    total+=parseInt($('.ppp_tprice').eq(index).text())
  })
  total+=parseInt($('.freight_price').text())
  $('.tot_price').html(total)
}
function sumNum(){
  tot_count = $('.p_info').length
  $('.tot_count').html(tot_count)
}



</script>
</html>