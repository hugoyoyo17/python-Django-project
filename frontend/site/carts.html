<!DOCTYPE html>
<html lang="en">
     <head>
     <title>miumiu寵物商城</title>
     <meta charset="utf-8">
     <link rel="icon" href="images/favicon.ico">
     <link rel="shortcut icon" href="images/favicon.ico" />
     <link rel="stylesheet" href="css/style.css">
     <link rel="stylesheet" href="css/form.css">
     <script src="js/jquery.js"></script>
     <script src="js/init.js"></script>
     <script src="js/forms.js"></script>
     <script src="js/jquery-migrate-1.1.1.js"></script>
     <script src="js/superfish.js"></script>     
     <script src="js/jquery.equalheights.js"></script>
     <script src="js/jquery.easing.1.3.js"></script>
          <script src="js/jquery.ui.totop.js"></script>

     <script>
    
    jQuery(document).ready(function() {
    $().UItoTop({ easingType: 'easeOutQuart' });
    });
     </script>
     <!--[if lt IE 8]>
       <div style=' clear: both; text-align:center; position: relative;'>
         <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
           <img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." />
         </a>
      </div>
    <![endif]-->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <link rel="stylesheet" media="screen" href="css/ie.css">

    <![endif]-->
     </head>
     <body>
<!--==============================header=================================-->
<header> 
  <div class="container_12">
    <div class="grid_12"> 
    <h1><a href="index.html"><img src="images/logo.png" alt="Gerald Harris attorney at law"></a> </h1>
         <div class="menu_block">
           <nav  class="" >
            <ul class="sf-menu">
                   <!-- <li class="current"><a href="index.html">首頁</a></li> -->
                   <li><a href="index.html">首頁</a></li>
                   <li class="with_ul"><a href="product_list.html?list_for=貓咪商品">貓咪專區 </a>
                     <ul>
                         <li><a href="product_list.html?list_for=貓咪飼料"> 貓咪飼料</a></li>
                         <li><a href="product_list.html?list_for=貓咪罐頭">貓咪罐頭</a></li>
                         <li><a href="product_list.html?list_for=貓咪零食">貓咪零食</a></li>
                         <li><a href="product_list.html?list_for=貓咪用品">貓咪用品</a></li>
                     </ul>
                   </li>
                   <li class="with_ul"><a href="product_list.html?list_for=狗狗商品">狗狗專區</a>
                    <ul>
                      <li><a href="product_list.html?list_for=狗狗飼料">狗狗飼料</a></li>
                      <li><a href="product_list.html?list_for=狗狗罐頭">狗狗罐頭</a></li>
                      <li><a href="product_list.html?list_for=狗狗零食">狗狗零食</a></li>
                      <li><a href="product_list.html?list_for=狗狗用品">狗狗用品</a></li>
                  </ul>
                  </li>
                   <li><a href="adoption.html">浪浪之家 </a></li>
                 </ul>
              </nav>
           <div class="clear"></div>
           </div>
           <div class="clear"></div>
           <div class="right">
            <ul class="login">
              <li>
                <a href="carts.html"><img src="images/shop_car.png" title="我的購物車">
                <b class="my_car_count">0</b>
                </a>   
              </li>
              <li><a href="login.html" id="my_login">登入</a></li>
            </ul>
          </div>
      </div>
    </div>
</header>


<div class="content2 pt1">
  <!-- <div class="ic">More Website Templates @ TemplateMonster.com - June 10, 2013!</div> -->
  <div class="container_12">
    <div class="sign_up">
        <h2 class="ic1">購物車</h2>
        <p class="total_price">已選<span class="total_num color">0</span>件商品<span class="interval"></span>合計(不含運費):<span
            class="totalPrices color susum">0.00</span><span class="unit color">元</span></p>
    </div>
     <div class="grid_cart prefix_1 ">
        <div id="box">
            <div id="content_box">
                <div class="imfor_top">
                    <div class="check_top">
                        <div class="all">
                <input style="float:left;margin-top:12px" type='checkbox' name="allcheck"
                             checked   id="allcheck">全選
                        </div>
                    </div>
                    <div class="pudc_top">商品</div>
                    <div class="pices_top">單價(元)</div>
                    <div class="num_top">數量</div>
                    <div class="totle_top">金額</div>
                    <div class="del_top">操作</div>
                </div>

                <!-- 購物車商品 -->
                <div id="cart_imfor" >
                    <!-- <div class="imfor">           <div class="check">                <div class="Each">                     <input type="checkbox" checked="" name="" value="1">                 </div>           </div>            <div class="pudc">               <div class="pudc_information" id="pudcId1">                    <img src="http://127.0.0.1:8000/media/sku/dog_feed.jpg" class="lf" style="width: 70px">                   <input type="hidden" name="" value="">                    <span class="des lf">
                        老犬飼料 長壽配方 低過敏 小顆粒 狗飼料                     <input type="hidden" name="" value="">                   </span><p class="col lf"><span>尺寸：</span><span class="color_des">2KG</span></p>               </div>           </div>           <div class="pices">                            <p class="pices_information"><b>￥</b><span class="pices_price">88</span></p>           </div>           <div class="num"><span class="reduc">&nbsp;-&nbsp;</span><input class="num1207" data-id="1" readonly="" type="text" value="3"><span class="add">&nbsp;+&nbsp;</span></div>           <div class="totle">                                                                     <span>￥</span>           <span data-id="1" class="totle_information">264</span>       </div>      <div class="del"> <a href="javascript:;" data-id="1" class="del_d">删除</a> </div></div> -->
                </div>

            </div>
            <div class="foot">
                <div class="foot_check">
                    <div class="all">
                    </div>
                </div>

                <button class="foot_cash" id="go-buy">去结算</button>
                <div class="foot_tol"><span>合計(不含運費):</span><span class="foot_pices susumOne">0.00</span><span
                        class='foot_des'>元</span></div>
                <div class="foot_selected">
                    已選<span class="totalOne color">0</span>件商品


       
       

       

       
      
       <!-- <form id="form">
       <div class="success_wrapper">
       <div class="success">Contact form submitted!<br>
       <strong>We will be in touch soon.</strong> </div></div>
       <fieldset>
       <label class="name">
       <input type="text" value="Name:">
       <br class="clear">
       <span class="error error-empty">*This is not a valid name.</span><span class="empty error-empty">*This field is required.</span> </label>
       <label class="email">
       <input type="text" value="E-mail:">
       <br class="clear">
       <span class="error error-empty">*This is not a valid email address.</span><span class="empty error-empty">*This field is required.</span> </label>
       <label class="phone">
       <input type="tel" value="Phone:">
       <br class="clear">
       <span class="error error-empty">*This is not a valid phone number.</span><span class="empty error-empty">*This field is required.</span> </label>
       <label class="message">
       <textarea></textarea>
       <br class="clear">
       <span class="error">*The message is too short.</span> <span class="empty">*This field is required.</span> </label>
       <div class="clear"></div>
       <div class="btns"><a data-type="reset" class="btn">Clear</a><a data-type="submit" class="btn">Send</a>
       <div class="clear"></div>
       </div></fieldset></form> -->
        
     </div>
   </div>
  </div>
</div>
</div>
</div>
<!--=======content================================-->



<!--==============================footer=================================-->

<footer>    
  <div class="container_12">
    <div class="grid_12">
      <div class="socials">
        <a href="#"></a>
        <a href="#"></a>
        <a href="#"></a>
        <a href="#"></a>
      </div>
     <p>Pet Club  &copy; 2013 | <a href="#">Privacy Policy</a> | Website  designed by <a href="http://www.templatemonster.com/" rel="nofollow">TemplateMonster.com</a></p>
     
    </div>
    <div class="clear"></div>
  </div>
</footer>
</body>
</html>



<script>
$(function(){
  var email = window.localStorage.getItem('miushop_email')

  $.ajax({
    type:'get',
    url:baseUrl+'/v1/carts/'+email,
    beforeSend:function(request){
      request.setRequestHeader('authorization',localStorage.getItem('miushop_token'))
    },
    success:function(data){
      if (data.code == 403) {
        alert('用戶認證已過期，請重新登入')
        window.localStorage.removeItem('miushop_username');
        window.localStorage.removeItem('miushop_email');
        window.localStorage.removeItem('miushop_token');
        window.localStorage.removeItem('miushop_cartscount');
        window.location.href = 'login.html'
      }
      if(data.code==200){
        var cd = data.data
        var IMG_URL = data.base_url
        var html = ''
        for(var i=0;i<cd.length;i++){
          var spec = cd[i].sku_sale_attr_name.toString().split('/')[1]
          html += '<div class="imfor">'
          html += '<div class="check">'
          html += '<div class="Each">'
          if(cd[i].selected==1){
            html += '<input type="checkbox" checked name="" value="' + cd[i].id + '">'
          }
          else{
            html += '<input type="checkbox" name="" value="' + cd[i].id + '">'
          }
          
          html += '</div>'
          html += '</div>'
          html += '<div class="pudc">'
          html += '<div class="pudc_information" id="pudcId1">'
          html += '<img src="' + IMG_URL + cd[i].image + '" class="lf" style="width: 70px;height:70px">'
          html += '<input type="hidden" name="" value="">'
          html += '<span class="des lf">' + cd[i].name + '<input type="hidden" name="" value=""></span>'
          html += '<p class="col lf"><span>' + spec + '：</span><span class="color_des"></span>' + cd[i].sku_sale_attr_value + '</p> '
          html += '</div>'
          html += '</div>'
          html += '<div class="pices">'
          html += '<p class="pices_information"><b>NT$</b><span class="pices_price">' + cd[i].price + '</span></p>'
          html += '</div>'
          html+='<div class="num">'
          html+='<span class="reduc">&nbsp;-&nbsp;</span>'
          html+='<input class="num1207" data-id="'+cd[i].id+'" readonly="" type="text" value="'+cd[i].count+'"><span class="add">&nbsp;+&nbsp;</span><span style="display:none;">'+cd[i].stock_number+'</span>'
          html+='</div>'
          html+= '<div class="totle">'
          html+='<span>NT$</span>'
          html+='<span data-id="'+cd[i].id+'" class="totle_information">'+cd[i].count*cd[i].price+'</span>'
          html+='</div>'
          html+='<div class="del"> <a href="javascript:;" data-id="'+cd[i].id+'" class="del_d">刪除</a> </div>'
          html+='</div>'
        }
                  
        $('#cart_imfor').html(html)
        var count = window.localStorage.getItem('miushop_cartscount')
        if(count==0){
          $("#go-buy").css("background", "gray")
          $("#go-buy").attr("disabled", true)
        }

        sumPrice()
        sunNum()
        $('.del_d').click(function(){  
          var id = $(this).data('id')
          // console.log(id)
          del(id);

        



        })

      }else{
        alert(data.error)
      }          
    }
  })

$('#allcheck').click(function(){
  if($(this).prop('checked')){
    $('.Each input:checkbox').prop('checked',true)
    sumPrice()
    sunNum()
    $.ajax({
      type:'put',
      url:baseUrl+'/v1/carts/'+email,
      contentType:'application/json',
      dataType:'json',
      data:JSON.stringify({
        'state':'selectall'
      }),
      beforeSend: function (request) {
        request.setRequestHeader('authorization', window.localStorage.getItem('miushop_token'))
      },
      success:function(data){
        if (data.code == 403) {
        alert('用戶認證已過期，請重新登入')
        window.localStorage.removeItem('miushop_username');
        window.localStorage.removeItem('miushop_email');
        window.localStorage.removeItem('miushop_token');
        window.localStorage.removeItem('miushop_cartscount');
        window.location.href = 'login.html'
      }
      if(data.code==200){
        console.log('全選')
      }else{
        console.log(data.error)
      }
      }
    })
  }else{
    $('.Each input:checkbox').prop('checked',false)
    sumPrice()
    sunNum()
    $.ajax({
      type:'put',
      url:baseUrl+'/v1/carts/'+email,
      contentType:'application/json',
      dataType:'json',
      data:JSON.stringify({
        'state':'unselectall'
      }),
      beforeSend: function (request) {
        request.setRequestHeader('authorization', window.localStorage.getItem('miushop_token'))
      },
      success:function(data){
        if (data.code == 403) {
        alert('用戶認證已過期，請重新登入')
        window.localStorage.removeItem('miushop_username');
        window.localStorage.removeItem('miushop_email');
        window.localStorage.removeItem('miushop_token');
        window.localStorage.removeItem('miushop_cartscount');
        window.location.href = 'login.html'
      }
      if(data.code==200){
        console.log('取消全選')
      }else{
        console.log(data.error)
      }
      }
    })
  }
})

  $(document).on('click', '.Each input:checkbox', function () {
    var id = parseInt($(this).val())
    console.log(id)
    sumPrice()
    sunNum()

    if($(this).prop('checked')){
      $.ajax({
      type:'put',
      url:baseUrl+'/v1/carts/'+email,
      contentType:'application/json',
      dataType:'json',
      data:JSON.stringify({
        'sku_id':id,
        'state':'select'
      }),
      beforeSend: function (request) {
        request.setRequestHeader('authorization', window.localStorage.getItem('miushop_token'))
      },
      success:function(data){
        if (data.code == 403) {
        alert('用戶認證已過期，請重新登入')
        window.localStorage.removeItem('miushop_username');
        window.localStorage.removeItem('miushop_email');
        window.localStorage.removeItem('miushop_token');
        window.localStorage.removeItem('miushop_cartscount');
        window.location.href = 'login.html'
      }
      if(data.code==200){
        console.log('勾選')
      }else{
        console.log(data.error)
      }
      }
    })
    }
    else{
      $.ajax({
      type:'put',
      url:baseUrl+'/v1/carts/'+email,
      contentType:'application/json',
      dataType:'json',
      data:JSON.stringify({
        'sku_id':id,
        'state':'unselect'
      }),
      beforeSend: function (request) {
        request.setRequestHeader('authorization', window.localStorage.getItem('miushop_token'))
      },
      success:function(data){
        if (data.code == 403) {
        alert('用戶認證已過期，請重新登入')
        window.localStorage.removeItem('miushop_username');
        window.localStorage.removeItem('miushop_email');
        window.localStorage.removeItem('miushop_token');
        window.localStorage.removeItem('miushop_cartscount');
        window.location.href = 'login.html'
      }
      if(data.code==200){
        console.log('取消勾選')
      }else{
        console.log(data.error)
      }
      }
    })
    }

  })

  $(document).on('click', '.add', function () {
  var buy_num = $(this).prev();
  var stock = $(this).next();
  var stock_number = parseInt(stock.text());
  var num = buy_num.val();
  var id = buy_num.data('id');
  if(num<stock_number){
    num++;
    buy_num.val(num)

    var price = parseInt($(this).parent().prev().children('.pices_information').children('.pices_price').text())
    total_price = price * num
    $(this).parent().next().children('.totle_information').html(total_price);
    sumPrice()

    $.ajax({
      type: 'put',
      url: baseUrl + '/v1/carts/' + email,
      contentType: 'application/json',
      dataType: 'json',
      data: JSON.stringify({
        'sku_id': id,
        'state': 'add'
      }),
      beforeSend: function (request) {
        request.setRequestHeader('authorization', window.localStorage.getItem('miushop_token'))
      },
      success: function (data) {
        if (data.code == 403) {
          alert('用戶認證已過期，請重新登入')
          window.localStorage.removeItem('miushop_username');
          window.localStorage.removeItem('miushop_email');
          window.localStorage.removeItem('miushop_token');
          window.localStorage.removeItem('miushop_cartscount');
          window.location.href = 'login.html'
        }
        if (data.code == 200) {
          console.log('添加成功')
        } else {
          alert(data.error)
        }
      }
    })    
  }

  });

  $(document).on('click', '.reduc', function () {
    var buy_num = $(this).next();
    var num = buy_num.val();
    var id = buy_num.data('id');
    if (num > 1) {
      num--;
      buy_num.val(num)
      var price = parseInt($(this).parent().prev().children('.pices_information').children('.pices_price').text())
      total_price = price * num
      $(this).parent().next().children('.totle_information').html(total_price);
      sumPrice()
      $.ajax({
      type:'put',
      url:baseUrl+'/v1/carts/'+email,
      contentType:'application/json',
      dataType:'json',
      data:JSON.stringify({
        'sku_id':id,
        'state':'reduce'
      }),
      beforeSend: function (request) {
        request.setRequestHeader('authorization', window.localStorage.getItem('miushop_token'))
      },
      success:function(data){
        if (data.code == 403) {
        alert('用戶認證已過期，請重新登入')
        window.localStorage.removeItem('miushop_username');
        window.localStorage.removeItem('miushop_email');
        window.localStorage.removeItem('miushop_token');
        window.localStorage.removeItem('miushop_cartscount');
        window.location.href = 'login.html'
      }
      if(data.code==200){
        console.log('減量成功')
      }else{
        console.log(data.error)
      }
      }
    })
    }
  });




})

  function sumPrice() {
    var total = 0
    $('.Each input:checkbox').each(function (index, element) {
      if ($(this).prop('checked')) {
        total += parseInt($('.totle_information').eq(index).text())
      }
    })
    $(".susumOne,.susum").html(total);
  }

  function sunNum(){
    var num = $('.Each input:checkbox:checked').length
    $('.total_num,.totalOne').html(num)
    if(num==0){
      $("#go-buy").css("background", "gray")
      $("#go-buy").attr("disabled", true)
    } else {
      $("#go-buy").css("background", "#997679")
      $("#go-buy").attr("disabled", false)
    }
  }

  function del(id){
    var email = window.localStorage.getItem('miushop_email')
    $.ajax({
      type:'delete',
      url:baseUrl+'/v1/carts/'+email,
      dataType:'json',
      contentType:'application/json',
      data:JSON.stringify({id}),
      beforeSend: function (request) {
        request.setRequestHeader('authorization', window.localStorage.getItem('miushop_token'))
      },
      success:function(data){
        if (data.code == 403) {
        alert('用戶認證已過期，請重新登入')
        window.localStorage.removeItem('miushop_username');
        window.localStorage.removeItem('miushop_email');
        window.localStorage.removeItem('miushop_token');
        window.localStorage.removeItem('miushop_cartscount');
        window.location.href = 'login.html'
      }
        if(data.code==200){
          alert('刪除成功')
          window.localStorage.setItem('miushop_cartscount',data.data.carts_count)
          $('.my_car_count').text(data.data.carts_count)
          window.location.reload()
        }
      }
    })
  }
    
  $('#go-buy').click(function(){
    window.location.href='order_confirm.html'
  })


</script>